<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Vinex - Industry</title>
  <link rel="icon" href="../uploads/logo-main.png">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --brand: #2B82C8;
      --brand-dark: #0E4A78;
      --brand-rgb: 43,130,200;
      --brand-dark-rgb: 14,74,120;
      --primary: var(--brand);
      --accent: #4CC3E6;
      --accent-rgb: 76,195,230;
      --bg: #ffffff;
      --bg-light: #f4fbff;
      --text: #0F1724;
      --muted: #6b7280;
      --border: rgba(var(--brand-dark-rgb),0.08);
      --radius: 10px;
      --shadow: 0 8px 30px rgba(var(--brand-dark-rgb),0.12);
      --transition: 0.22s ease;
      --logo-size: 50px;
      --header-h: 72px;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { height: 100%; }
    
    body {
      font-family: 'Nunito', system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
      color: var(--text);
      background: #f5f8ff;
      min-height: 100vh;
    }

    .site-header {
      position: fixed;
      top: 0; left: 0; right: 0;
      height: var(--header-h);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 24px;
      background: #fff;
      border-bottom: 1px solid var(--border);
      box-shadow: 0 4px 18px rgba(var(--brand-dark-rgb), 0.04);
      z-index: 1000;
    }

    .brand { display: flex; align-items: center; gap: 12px; text-decoration: none; }
    .brand .logo { width: var(--logo-size); height: var(--logo-size); object-fit: contain; border-radius: 8px; }
    .brand-title {
      display: block;
      font-family: 'Montserrat', sans-serif;
      font-weight: 200;
      font-size: 30px;
      letter-spacing: 1px;
      color: var(--primary);
      margin-left: 4px;
    }

    .site-nav { position: absolute; left: 50%; transform: translateX(-50%); display: flex; gap: 18px; align-items:center; }
    .site-nav a { color: var(--primary); text-decoration: none; font-weight:600; padding: 8px 10px; border-radius:8px; }
    .site-nav a.active { background: var(--bg-light); }
    .site-nav a:hover { background: var(--bg-light); }

    .profile-wrap { position: relative; display: flex; align-items: center; gap: 12px; }
    .profile-btn {
      display: inline-flex; align-items: center; gap: 10px;
      background: transparent; border: none; cursor: pointer; padding: 6px 8px; border-radius: 8px;
    }
    .profile-avatar { width: 42px; height: 42px; border-radius: 10px; object-fit: cover; box-shadow: var(--shadow); }
    .profile-meta { text-align: right; display: none; }
    .profile-name { font-weight: 700; color: var(--primary); font-size: 14px; }
    .profile-role { font-size: 12px; color: var(--muted); }

    .profile-menu {
      position: absolute; right: 0; top: calc(100% + 8px);
      background: #fff; border: 1px solid var(--border); border-radius: 10px; box-shadow: var(--shadow);
      min-width: 160px; overflow: hidden; display: none;
    }
    .profile-menu a, .profile-menu button { display: block; padding: 10px 12px; text-decoration: none; color: var(--text); background: transparent; border: none; width: 100%; text-align: left; cursor: pointer; }
    .profile-menu a:hover, .profile-menu button:hover { background: var(--bg-light); }

    main { padding-top: calc(var(--header-h) + 24px); }
    .container { padding: 24px; width: 100%; max-width: none; margin: 0; }

    .page-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 28px;
      flex-wrap: wrap;
      gap: 16px;
    }

    .page-title { font-size: 32px; font-weight: 700; color: var(--text); margin-bottom: 8px; }

    .page-subtitle { color: var(--muted); font-size: 14px; }

    .btn {
      padding: 12px 18px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-weight: 700;
      font-size: 14px;
      transition: var(--transition);
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .btn-primary {
      background: var(--brand);
      color: #fff;
    }

    .btn-primary:hover {
      background: var(--brand-dark);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(var(--brand-rgb), 0.2);
    }

    .projects-container {
      background: transparent;
      border-radius: var(--radius);
      box-shadow: none;
      border: none;
      overflow: visible;
    }

    .projects-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 24px;
      padding: 0;
      background: transparent;
      border-radius: var(--radius);
      box-shadow: none;
      border: none;
    }

    .project-card {
      background: #fff;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      display: flex;
      gap: 16px;
      padding: 18px;
      align-items: flex-start;
      transition: var(--transition);
      box-shadow: var(--shadow);
      border-bottom: 1px solid var(--border);
    }

    .project-card:last-child {
      border-bottom: 1px solid var(--border);
    }

    .project-card .thumb {
      width: 220px;
      height: 130px;
      border-radius: 8px;
      object-fit: cover;
      flex-shrink: 0;
    }

    .project-card .meta {
      flex: 1;
    }

    .project-card h3 {
      margin-bottom: 6px;
      color: var(--primary);
      font-size: 16px;
    }

    .project-card p {
      color: var(--muted);
      margin-bottom: 8px;
      font-size: 14px;
    }

    .project-info {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      align-items: center;
      margin-bottom: 12px;
    }

    .chip {
      background: var(--bg-light);
      border: 1px solid var(--border);
      padding: 6px 10px;
      border-radius: 999px;
      font-size: 12px;
      color: var(--primary);
    }

    .project-actions-manage {
      margin-left: auto;
      display: flex;
      gap: 8px;
      align-items: center;
      flex-wrap: wrap;
    }

    .btn-chat-link {
      background: transparent;
      border: none;
      color: var(--brand);
      font-weight: 600;
      text-decoration: underline;
      cursor: pointer;
      padding: 8px 2px;
      border-radius: 8px;
      transition: var(--transition);
      font-size: 14px;
    }

    .btn-chat-link:hover {
      background: var(--bg-light);
      text-decoration: none;
    }

    .project-student-info {
      margin-top: 8px;
      padding: 12px;
      background: var(--bg-light);
      border-radius: 8px;
      font-size: 13px;
      color: var(--text);
    }

    .project-student-info label {
      color: var(--muted);
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .review-modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      padding: 20px;
    }

    .review-modal.show {
      display: flex;
    }

    .review-modal-content {
      background: #fff;
      border-radius: var(--radius);
      padding: 32px;
      max-width: 600px;
      width: 100%;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: var(--shadow);
    }

    .review-modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 1px solid var(--border);
    }

    .review-modal-header h2 {
      color: var(--primary);
      font-size: 22px;
    }

    .review-modal-close {
      background: transparent;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: var(--muted);
    }

    .review-modal-close:hover {
      color: var(--text);
    }

    .review-section {
      margin-bottom: 24px;
    }

    .review-section label {
      display: block;
      font-size: 13px;
      font-weight: 600;
      color: var(--primary);
      margin-bottom: 8px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .review-submission-files {
      background: var(--bg-light);
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 16px;
    }

    .review-submission-item {
      padding: 8px;
      background: #fff;
      border-radius: 6px;
      margin-bottom: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 13px;
    }

    .review-submission-item:last-child {
      margin-bottom: 0;
    }

    .review-submission-link {
      color: var(--brand);
      text-decoration: underline;
      cursor: pointer;
    }

    .star-rating {
      display: flex;
      gap: 8px;
      font-size: 28px;
    }

    .star {
      cursor: pointer;
      color: #ddd;
      transition: var(--transition);
    }

    .star:hover,
    .star.active {
      color: #ffc107;
    }

    .review-textarea {
      width: 100%;
      padding: 12px;
      border: 1px solid var(--border);
      border-radius: 8px;
      font-size: 14px;
      font-family: 'Nunito', sans-serif;
      resize: vertical;
      min-height: 80px;
    }

    .review-textarea:focus {
      outline: none;
      border-color: var(--brand);
      box-shadow: 0 0 0 3px rgba(var(--brand-rgb), 0.08);
    }

    .payment-input-group {
      display: flex;
      gap: 8px;
    }

    .payment-input-group input {
      flex: 1;
      padding: 10px 12px;
      border: 1px solid var(--border);
      border-radius: 8px;
      font-size: 14px;
      font-family: 'Nunito', sans-serif;
    }

    .payment-input-group input:focus {
      outline: none;
      border-color: var(--brand);
      box-shadow: 0 0 0 3px rgba(var(--brand-rgb), 0.08);
    }

    .upload-proof {
      border: 2px dashed var(--border);
      padding: 16px;
      border-radius: 8px;
      text-align: center;
      color: var(--muted);
      cursor: pointer;
      transition: var(--transition);
      background: var(--bg-light);
    }

    .upload-proof:hover {
      border-color: var(--brand);
      background: rgba(var(--brand-rgb), 0.02);
    }

    .upload-proof input[type="file"] {
      display: none;
    }

    .proof-filename {
      margin-top: 8px;
      color: var(--text);
      font-weight: 600;
      font-size: 13px;
    }

    .review-actions {
      display: flex;
      gap: 12px;
      margin-top: 24px;
      padding-top: 24px;
      border-top: 1px solid var(--border);
    }

    .btn-reject {
      flex: 1;
      padding: 12px 18px;
      background: transparent;
      color: #ef4444;
      border: 1px solid #ef4444;
      border-radius: 8px;
      font-weight: 700;
      cursor: pointer;
      transition: var(--transition);
      font-size: 14px;
    }

    .btn-reject:hover {
      background: #fee2e2;
    }

    .btn-approve {
      flex: 1;
      padding: 12px 18px;
      background: #10b981;
      color: #fff;
      border: none;
      border-radius: 8px;
      font-weight: 700;
      cursor: pointer;
      transition: var(--transition);
      font-size: 14px;
    }

    .btn-approve:hover {
      background: #059669;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(16, 185, 129, 0.2);
    }

    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: var(--muted);
    }

    .empty-state-icon {
      font-size: 48px;
      margin-bottom: 12px;
    }

    .empty-state p {
      margin-bottom: 16px;
    }

    .site-footer {
      margin-top: 28px;
      padding: 28px 0;
      background: transparent;
      color: var(--muted);
      border-top: 1px solid var(--border);
    }
    
    .footer-inner {
      max-width: none;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      padding: 0 6%;
    }
    
    .footer-logo {
      width: 48px;
      height: 48px;
      object-fit: contain;
    }
    
    .footer-bottom {
      padding: 0 6%;
      margin-top: 34px;
    }
    
    .footer-links {
      display: flex;
      gap: 12px;
    }
    
    .footer-links a {
      color: var(--muted);
      text-decoration: none;
    }
    
    .footer-brand {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .footer-brand p {
      margin: 0;
    }

    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 20px;
      margin-bottom: 32px;
    }

    .stat-card {
      background: #fff;
      border-radius: var(--radius);
      padding: 24px;
      box-shadow: var(--shadow);
      border: 1px solid var(--border);
      text-align: center;
      transition: var(--transition);
    }

    .stat-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 40px rgba(var(--brand-dark-rgb), 0.15);
    }

    .stat-icon {
      font-size: 32px;
      margin-bottom: 12px;
    }

    .stat-number {
      font-size: 32px;
      font-weight: 700;
      color: var(--primary);
      margin-bottom: 8px;
    }

    .stat-label {
      color: var(--muted);
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .btn-small {
      padding: 10px 16px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-weight: 600;
      font-size: 13px;
      transition: var(--transition);
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .btn-small-primary {
      background: var(--brand);
      color: #fff;
    }

    .btn-small-primary:hover {
      background: var(--brand-dark);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(var(--brand-rgb), 0.2);
    }

    .btn-small-danger {
      background: transparent;
      border: 1px solid var(--border);
      color: var(--text);
    }

    .btn-small-danger:hover {
      border-color: var(--brand);
      color: var(--brand);
      background: var(--bg-light);
    }

    /* Notification Modal Styles */
    .notification-modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 2001;
      padding: 20px;
    }

    .notification-modal.show {
      display: flex;
    }

    .notification-modal-content {
      background: #fff;
      border-radius: var(--radius);
      padding: 32px;
      max-width: 500px;
      width: 100%;
      box-shadow: var(--shadow);
      text-align: center;
    }

    .notification-modal-icon {
      font-size: 48px;
      margin-bottom: 16px;
    }

    .notification-modal-title {
      color: var(--primary);
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 12px;
    }

    .notification-modal-message {
      color: var(--muted);
      font-size: 14px;
      margin-bottom: 24px;
      line-height: 1.5;
    }

    .notification-modal-actions {
      display: flex;
      gap: 12px;
      justify-content: center;
    }

    .notification-btn {
      padding: 12px 24px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      transition: var(--transition);
    }

    .notification-btn-primary {
      background: var(--brand);
      color: #fff;
    }

    .notification-btn-primary:hover {
      background: var(--brand-dark);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(var(--brand-rgb), 0.2);
    }

    .notification-btn-secondary {
      background: var(--bg-light);
      color: var(--text);
      border: 1px solid var(--border);
    }

    .notification-btn-secondary:hover {
      border-color: var(--brand);
      color: var(--brand);
    }

    @media (max-width: 900px) {
      .site-nav {
        display: none;
      }

      .project-card {
        flex-direction: column;
      }

      .project-card .thumb {
        width: 100%;
        height: 200px;
      }

      .project-actions-manage {
        margin-left: 0;
        width: 100%;
        justify-content: space-between;
      }

      .btn-small {
        flex: 1;
      }
    }

    @media (max-width: 520px) {
      .container {
        padding: 16px;
      }

      .page-header {
        flex-direction: column;
        align-items: flex-start;
      }

      .page-title {
        font-size: 24px;
      }

      .project-card {
        padding: 12px;
      }

      .project-card .thumb {
        height: 150px;
      }

      .project-actions-manage {
        flex-direction: column;
      }

      .btn-small {
        width: 100%;
        padding: 10px 12px;
      }
    }
  </style>
</head>
<body>
  <header class="site-header">
    <a href="projects-manage.html" class="brand">
      <img src="../uploads/logo-main.png" alt="Vinex" class="logo">
      <h2 class="brand-title">Vinex</h2>
    </a>

    <nav class="site-nav">
      <a href="projects-manage.html">Dashboard</a>
      <a href="requests.html">Requests</a>
    </nav>

    <div class="profile-wrap">
      <div class="profile-meta" id="headerProfileMeta" style="display:none; text-align:right;">
        <div class="profile-name" id="headerPicName"></div>
        <div class="profile-role" id="headerCompanyName"></div>
      </div>
      <button class="profile-btn" id="profileBtn">
        <img src="../uploads/pfp.jpg" alt="Profile" class="profile-avatar">
      </button>

      <div class="profile-menu" id="profileMenu">
        <a href="profile.html">View Profile</a>
        <button id="logoutBtn">Logout</button>
      </div>
    </div>
  </header>

  <main>
    <div class="container">
      <div class="page-header">
        <div>
          <h1 class="page-title">Dashboard</h1>
          <p class="page-subtitle">Manage and track your active projects</p>
        </div>
        <a href="upload-project.html" class="btn btn-primary">+ Create Project</a>
      </div>

      <div class="dashboard-grid">
        <div class="stat-card">
          <div class="stat-number" id="statProjects">0</div>
          <div class="stat-label">Total Projects</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="statRequests">0</div>
          <div class="stat-label">New Requests</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="statInProgress">0</div>
          <div class="stat-label">In Progress</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="statCompleted">0</div>
          <div class="stat-label">Completed</div>
        </div>
      </div>

      <div class="projects-grid" id="projectsGrid">
        <div class="empty-state">
          <div class="empty-state-icon">üì≠</div>
          <p>No projects created yet</p>
          <a href="upload-project.html" class="btn btn-primary">Create First Project</a>
        </div>
      </div>
    </div>
  </main>

  <div class="notification-modal" id="notificationModal">
    <div class="notification-modal-content">
      <div class="notification-modal-icon" id="notificationIcon">‚ÑπÔ∏è</div>
      <div class="notification-modal-title" id="notificationTitle">Notification</div>
      <div class="notification-modal-message" id="notificationMessage">This is a notification message</div>
      <div class="notification-modal-actions">
        <button class="notification-btn notification-btn-primary" id="notificationOkBtn" onclick="closeNotification()">OK</button>
      </div>
    </div>
  </div>

  <div class="review-modal" id="reviewModal">
    <div class="review-modal-content">
      <div class="review-modal-header">
        <h2>Review Submitted Work</h2>
        <button class="review-modal-close" onclick="closeReviewModal()">‚úï</button>
      </div>

      <div class="review-section">
        <label>Student Submissions</label>
        <div class="review-submission-files" id="submissionFiles"></div>
      </div>

      <div class="review-section">
        <label>Rating</label>
        <div class="star-rating" id="starRating">
          <span class="star" data-value="1">‚òÖ</span>
          <span class="star" data-value="2">‚òÖ</span>
          <span class="star" data-value="3">‚òÖ</span>
          <span class="star" data-value="4">‚òÖ</span>
          <span class="star" data-value="5">‚òÖ</span>
        </div>
        <input type="hidden" id="reviewRating" value="0">
      </div>

      <div class="review-section">
        <label>Review Comments</label>
        <textarea class="review-textarea" id="reviewComments" placeholder="Enter your review and feedback..."></textarea>
      </div>

      <div class="review-section">
        <label>Payment Amount to Student</label>
        <div class="payment-input-group">
          <input type="text" placeholder="e.g., 300000" id="paymentAmount">
          <span style="padding: 10px; background: var(--bg-light); border-radius: 8px; font-weight: 600; color: var(--text);" id="paymentDisplay">Rp 0</span>
        </div>
      </div>

      <div class="review-section">
        <label>Upload Payment Proof</label>
        <div class="upload-proof" id="uploadProof" onclick="document.getElementById('paymentProofFile').click()">
          <div>üìÅ Click to upload payment proof</div>
          <div class="upload-hint" style="font-size: 12px; margin-top: 4px;">JPG, PNG, PDF (Max 5MB)</div>
          <div class="proof-filename" id="proofFilename" style="display: none;"></div>
          <input type="file" id="paymentProofFile" accept="image/*,.pdf">
        </div>
      </div>

      <div class="review-actions">
        <button class="btn-reject" onclick="rejectWork()">Reject & Send Back</button>
        <button class="btn-approve" onclick="approveWork()">Approve & Complete</button>
      </div>
    </div>
  </div>

  <footer class="site-footer">
    <div class="footer-inner">
      <div class="footer-brand">
        <img src="../uploads/logo-main.png" alt="logo" class="footer-logo">
        <div>
          <p class="muted">Micro projects & skill-proof hub for students and industry partners.</p>
        </div> 
      </div>

      <div class="footer-links">
        <a href="projects-manage.html">Dashboard</a>
        <a href="requests.html">Requests</a>
      </div>
    </div>
    <div class="footer-bottom">
      <small>Copyright ¬© <span id="yearSpan">2025</span> Vinix Seven Indonesia</small>
      <script>
        document.getElementById('yearSpan').textContent = new Date().getFullYear();
      </script>
    </div>
  </footer>

  <script>
    // Notification Modal Functions
    function showNotification(title, message, icon = '‚úì', callback = null) {
      document.getElementById('notificationIcon').textContent = icon;
      document.getElementById('notificationTitle').textContent = title;
      document.getElementById('notificationMessage').textContent = message;
      
      const okBtn = document.getElementById('notificationOkBtn');
      okBtn.textContent = 'OK';
      
      if (callback) {
        okBtn.onclick = function() {
          closeNotification();
          callback();
        };
      } else {
        okBtn.onclick = closeNotification;
      }
      
      document.getElementById('notificationModal').classList.add('show');
    }

    function showConfirmation(title, message, icon = '‚ö†Ô∏è', onConfirm = null, onCancel = null) {
      document.getElementById('notificationIcon').textContent = icon;
      document.getElementById('notificationTitle').textContent = title;
      document.getElementById('notificationMessage').textContent = message;
      
      const actionDiv = document.querySelector('.notification-modal-actions');
      actionDiv.innerHTML = `
        <button class="notification-btn notification-btn-secondary" onclick="closeNotification()">Cancel</button>
        <button class="notification-btn notification-btn-primary" id="confirmBtn">Confirm</button>
      `;
      
      const confirmBtn = document.getElementById('confirmBtn');
      confirmBtn.onclick = function() {
        closeNotification();
        if (onConfirm) onConfirm();
      };
      
      document.getElementById('notificationModal').classList.add('show');
    }

    function closeNotification() {
      document.getElementById('notificationModal').classList.remove('show');
    }

    document.addEventListener('DOMContentLoaded', function() {
      const profileBtn = document.getElementById('profileBtn');
      const profileMenu = document.getElementById('profileMenu');
      const logoutBtn = document.getElementById('logoutBtn');
      const headerProfileMeta = document.getElementById('headerProfileMeta');
      const headerPicName = document.getElementById('headerPicName');
      const headerCompanyName = document.getElementById('headerCompanyName');

      // Check if user is logged in
      const industryLogin = localStorage.getItem('industryLogin');
      if (!industryLogin) {
        window.location.href = './index.html';
        return;
      }

      const loginData = JSON.parse(industryLogin);
      
      // Get profile data to display PIC name and company name
      const industryProfile = JSON.parse(localStorage.getItem('industryProfile') || '{}');
      const industryRegistry = JSON.parse(localStorage.getItem('industryRegistry') || '{}');
      const registeredData = industryRegistry[loginData.email.toLowerCase()] || {};
      
      // Get PIC name and company name
      const picName = industryProfile.contactPerson || registeredData.contactPerson || loginData.name || 'PIC';
      const companyName = industryProfile.companyName || registeredData.companyName || 'Perusahaan';
      
      // Display PIC name and company name in header
      headerPicName.textContent = picName;
      headerCompanyName.textContent = companyName;
      headerProfileMeta.style.display = 'block';

      // Profile menu toggle
      profileBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        profileMenu.style.display = profileMenu.style.display === 'none' ? 'block' : 'none';
      });

      // Close menu when clicking outside
      document.addEventListener('click', function(e) {
        if (!e.target.closest('.profile-wrap')) {
          profileMenu.style.display = 'none';
        }
      }, true);

      // Logout
      logoutBtn.addEventListener('click', function() {
        localStorage.removeItem('industryLogin');
        localStorage.removeItem('industryProfile');
        window.location.href = './index.html';
      });

      // Setup star rating functionality
      const stars = document.querySelectorAll('#starRating .star');
      stars.forEach(star => {
        star.addEventListener('click', function() {
          const value = this.getAttribute('data-value');
          document.getElementById('reviewRating').value = value;
          
          stars.forEach((s, index) => {
            if (index < value) {
              s.classList.add('active');
            } else {
              s.classList.remove('active');
            }
          });
        });

        star.addEventListener('mouseover', function() {
          const value = this.getAttribute('data-value');
          stars.forEach((s, index) => {
            if (index < value) {
              s.style.color = '#ffc107';
            } else {
              s.style.color = '#ddd';
            }
          });
        });
      });

      document.getElementById('starRating').addEventListener('mouseleave', function() {
        const currentRating = document.getElementById('reviewRating').value;
        stars.forEach((star, index) => {
          if (index < currentRating) {
            star.style.color = '#ffc107';
          } else {
            star.style.color = '#ddd';
          }
        });
      });

      // Payment amount formatter
      document.getElementById('paymentAmount').addEventListener('input', function() {
        const amount = parseInt(this.value) || 0;
        document.getElementById('paymentDisplay').textContent = new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR' }).format(amount);
      });

      // Payment proof file upload
      document.getElementById('paymentProofFile').addEventListener('change', function() {
        if (this.files.length > 0) {
          const filename = this.files[0].name;
          document.getElementById('proofFilename').textContent = '‚úì ' + filename;
          document.getElementById('proofFilename').style.display = 'block';
        }
      });

      loadDashboardData();
      loadProjects();
    });

    function loadDashboardData() {
      // Load projects
      const projects = JSON.parse(localStorage.getItem('industryProjects') || '[]');
      
      // Count by status
      const totalProjects = projects.length;
      const inProgress = projects.filter(p => p.status === 'In Progress').length;
      const completed = projects.filter(p => p.status === 'Completed').length;
      const submittedForReview = projects.filter(p => p.status === 'Submitted for Review').length;
      
      // Count requests (new requests are those with 'new' or 'pending' status)
      const requests = JSON.parse(localStorage.getItem('studentRequests') || '[]');
      const newRequests = requests.filter(r => r.status === 'new' || r.status === 'pending').length;
      
      document.getElementById('statProjects').textContent = totalProjects;
      document.getElementById('statRequests').textContent = newRequests;
      document.getElementById('statInProgress').textContent = inProgress + submittedForReview;
      document.getElementById('statCompleted').textContent = completed;
    }

    function loadProjects() {
      let projects = JSON.parse(localStorage.getItem('industryProjects') || '[]');
      
      // Get company name from login/profile
      const industryLogin = localStorage.getItem('industryLogin');
      const loginData = industryLogin ? JSON.parse(industryLogin) : null;
      const industryProfile = JSON.parse(localStorage.getItem('industryProfile') || '{}');
      const industryRegistry = JSON.parse(localStorage.getItem('industryRegistry') || '{}');
      const registeredData = industryRegistry[loginData?.email?.toLowerCase() || ''] || {};
      const companyName = industryProfile.companyName || registeredData.companyName || loginData?.name || 'Perusahaan';
      
      // Add dummy projects if list is empty
      if (projects.length === 0) {
        const dummyProjects = [
          { 
            id: 101, 
            title: 'Mobile App Development', 
            company: companyName, 
            skills: ['React Native', 'JavaScript'], 
            cat: 'Web Dev & UI/UX', 
            image: '../uploads/coding.jpg', 
            desc: 'Membangun aplikasi mobile sederhana untuk manajemen tugas harian dengan fitur penambahan, pengeditan, dan penghapusan tugas.', 
            status: 'Available', 
            demand: 'Tinggi', 
            wage: 'Rp 250rb ‚Äì Rp 450rb' 
          },
          { 
            id: 102, 
            title: 'Cross Platform App', 
            company: companyName, 
            skills: ['Flutter', 'Dart'], 
            cat: 'Web Dev & UI/UX', 
            image: '../uploads/coding.jpg', 
            desc: 'Membangun aplikasi cross-platform untuk pelacakan kebiasaan dengan fitur pengingat harian, statistik, dan antarmuka yang menarik.', 
            status: 'In Progress',
            studentName: 'Siti Nurhaliza',
            demand: 'Medium', 
            wage: 'Rp 200rb - Rp 400rb' 
          },
          { 
            id: 103, 
            title: 'Web Application Development', 
            company: companyName, 
            skills: ['React', 'Node.js'], 
            cat: 'Web Dev & UI/UX', 
            image: '../uploads/coding.jpg', 
            desc: 'Membangun halaman FAQ sederhana berisi daftar pertanyaan umum dengan layout bersih, responsif, dan mudah dibaca.', 
            status: 'Submitted for Review',
            studentName: 'Radit Pratama',
            submissions: [
              { type: 'link', value: 'https://teamvip22.github.io/Final-project/projects.html' },
              { type: 'file', value: '../uploads/Final Project Kel 22.pdf' },
              { type: 'file', value: '../uploads/vinix.png' }
            ],
            demand: 'Tinggi', 
            wage: 'Rp 120rb - Rp 250rb' 
          },
          { 
            id: 104, 
            title: 'IoT Device Development', 
            company: companyName, 
            skills: ['Python', 'Arduino'], 
            cat: 'Web Dev & UI/UX', 
            image: '../uploads/coding.jpg', 
            desc: 'Membangun sistem monitoring suhu dan kelembaban berbasis IoT menggunakan sensor DHT11 dan mikrokontroler Arduino, dengan data yang dikirim ke server untuk analisis lebih lanjut.', 
            status: 'Available', 
            demand: 'Tinggi', 
            wage: 'Rp 500rb - Rp 750rb' 
          },
          { 
            id: 106, 
            title: 'E-commerce Website', 
            company: companyName, 
            skills: ['HTML', 'CSS', 'JavaScript'], 
            cat: 'Web Dev & UI/UX', 
            image: '../uploads/coding.jpg', 
            desc: 'Membangun website e-commerce sederhana dengan fitur katalog produk, keranjang belanja, dan proses checkout.', 
            status: 'Completed', 
            studentName: 'Zahra Aulia',
            demand: 'Medium', 
            wage: 'Rp 400rb' 
          }
        ];
        projects = dummyProjects;
        localStorage.setItem('industryProjects', JSON.stringify(projects));
      }

      const projectsGrid = document.getElementById('projectsGrid');
      
      // Update company name in all projects if user is logged in
      if (loginData) {
        projects = projects.map(project => ({
          ...project,
          company: companyName
        }));
      }

      projectsGrid.innerHTML = projects.map(project => {
        let actionsHTML = '';
        let studentHTML = '';
        let requestStatusHTML = '';

        // Tampilkan nama mahasiswa untuk semua status kecuali Available
        if (project.studentName) {
          studentHTML = `
            <div class="project-student-info">
              <label>Student Working On</label>
              <div style="margin-top: 4px; font-weight: 600;">${project.studentName}</div>
            </div>
          `;
        }

        // Request status tag removed as requested

        // Actions berdasarkan status
        if (project.status === 'Available') {
          actionsHTML = `
            <div class="project-actions-manage">
              <button class="btn-small btn-small-primary" onclick="editProject(${project.id})">Edit</button>
              <button class="btn-small btn-small-danger" onclick="deleteProject(${project.id})">Delete</button>
            </div>
          `;
        } else if (project.status === 'In Progress') {
          actionsHTML = `
            <div class="project-actions-manage">
              <button class="btn-chat-link" onclick=\"window.open('https://chat.whatsapp.com/FTtZAxlQ8p05miUdCDBHwb')\")">Chat Sekarang</button>
            </div>
          `;
        } else if (project.status === 'Submitted for Review') {
          actionsHTML = `
            <div class="project-actions-manage">
              <button class="btn-small btn-small-primary" onclick="openReviewModal(${project.id})">Review Work</button>
            </div>
          `;
        } else if (project.status === 'Completed') {
          actionsHTML = `
            <div class="project-actions-manage">
              <span style="color: var(--muted); font-size: 13px;">‚úì Completed</span>
            </div>
          `;
        }

        return `
          <div class="project-card">
            <img class="thumb" src="${project.image}" alt="${project.title}">
            <div class="meta">
              <h3>${project.title}</h3>
              <p class="muted">${project.company || 'Company'} ‚Ä¢ ${project.desc}</p>
              <div class="project-info">
                ${project.status ? `<div class="chip">Status: ${project.status}</div>` : ''}
                <div class="chip">Demand: ${project.demand}</div>
                <div class="chip">Category: ${project.cat}</div>
                <div class="chip">${project.wage}</div>
                ${project.skills.map(s=>`<div class="chip">${s}</div>`).join('')}
              </div>
              ${studentHTML}
            </div>
            ${actionsHTML}
          </div>
        `;
      }).join('');
    }

    function editProject(id) {
      window.location.href = `project-edit.html?id=${id}`;
    }

    function deleteProject(id) {
      showConfirmation(
        'Delete Project',
        'Are you sure you want to delete this project?',
        'üóëÔ∏è',
        function() {
          let projects = JSON.parse(localStorage.getItem('industryProjects') || '[]');
          projects = projects.filter(p => p.id !== id);
          localStorage.setItem('industryProjects', JSON.stringify(projects));
          loadProjects();
          showNotification('Success', 'Project deleted successfully', '‚úì');
        }
      );
    }

    let currentReviewProjectId = null;

    // Helper function to detect file type and create appropriate viewer
    function createSubmissionItem(sub, index) {
      let icon = 'üìÑ';
      let actionButton = '';
      let filename = sub.value;
      
      if (sub.type === 'link') {
        // Handle URLs
        icon = 'üîó';
        const url = sub.value;
        actionButton = `<a href="${url}" target="_blank" class="review-submission-link">Open Link</a>`;
        filename = url.length > 50 ? url.substring(0, 47) + '...' : url;
      } else if (sub.type === 'file') {
        // Detect file type and set appropriate icon
        const ext = filename.split('.').pop().toLowerCase();
        
        // Image files - show preview
        if (['jpg', 'jpeg', 'png', 'gif', 'webp', 'bmp'].includes(ext)) {
          icon = 'üñºÔ∏è';
          actionButton = `<button class="review-submission-link" style="background:none; border:none; padding:0; cursor:pointer;" onclick="viewImage('${filename}')">View</button>`;
        }
        // PDF files
        else if (ext === 'pdf') {
          icon = 'üìï';
          actionButton = `<button class="review-submission-link" style="background:none; border:none; padding:0; cursor:pointer;" onclick="viewPDF('${filename}')">View</button>`;
        }
        // Video files
        else if (['mp4', 'webm', 'ogg', 'avi', 'mov', 'mkv'].includes(ext)) {
          icon = 'üé•';
          actionButton = `<button class="review-submission-link" style="background:none; border:none; padding:0; cursor:pointer;" onclick="viewVideo('${filename}')">Play</button>`;
        }
        // Audio files
        else if (['mp3', 'wav', 'ogg', 'aac', 'm4a'].includes(ext)) {
          icon = 'üéµ';
          actionButton = `<button class="review-submission-link" style="background:none; border:none; padding:0; cursor:pointer;" onclick="playAudio('${filename}')">Play</button>`;
        }
        // Document files
        else if (['doc', 'docx'].includes(ext)) {
          icon = 'üìù';
          actionButton = `<button class="review-submission-link" style="background:none; border:none; padding:0; cursor:pointer;" onclick="downloadFile('${filename}')">Download</button>`;
        }
        // Excel/Spreadsheet files
        else if (['xls', 'xlsx', 'csv'].includes(ext)) {
          icon = 'üìä';
          actionButton = `<button class="review-submission-link" style="background:none; border:none; padding:0; cursor:pointer;" onclick="downloadFile('${filename}')">Download</button>`;
        }
        // Archive files
        else if (['zip', 'rar', '7z', 'tar', 'gz'].includes(ext)) {
          icon = 'üì¶';
          actionButton = `<button class="review-submission-link" style="background:none; border:none; padding:0; cursor:pointer;" onclick="downloadFile('${filename}')">Download</button>`;
        }
        // Default - generic download
        else {
          icon = 'üìé';
          actionButton = `<button class="review-submission-link" style="background:none; border:none; padding:0; cursor:pointer;" onclick="downloadFile('${filename}')">Download</button>`;
        }
      }
      
      return `
        <div class="review-submission-item">
          <span>${icon} ${filename}</span>
          ${actionButton}
        </div>
      `;
    }

    // Submission viewer functions
    function viewImage(filename) {
      showImageModal(filename);
    }

    function viewPDF(filename) {
      showPDFModal(filename);
    }

    function viewVideo(filename) {
      showVideoModal(filename);
    }

    function playAudio(filename) {
      showAudioModal(filename);
    }

    function downloadFile(filename) {
      // Implement real download without showing notification
      const link = document.createElement('a');
      link.href = `../uploads/${filename}`;
      link.download = filename;
      link.click();
    }

    function showImageModal(imagePath) {
      const modal = document.createElement('div');
      modal.style.cssText = `
        position: fixed; top: 0; left: 0; right: 0; bottom: 0;
        background: rgba(0, 0, 0, 0.8); display: flex; align-items: center;
        justify-content: center; z-index: 3000; padding: 20px;
      `;
      modal.innerHTML = `
        <div style="position: relative; max-width: 90%; max-height: 90%;">
          <button onclick="this.closest('div').parentElement.remove()" style="
            position: absolute; top: -40px; right: 0; background: white;
            border: none; width: 36px; height: 36px; border-radius: 50%;
            cursor: pointer; font-size: 20px; display: flex; align-items: center;
            justify-content: center;">
            ‚úï
          </button>
          <img src="../uploads/${imagePath}" style="max-width: 100%; max-height: 85vh; border-radius: 10px;">
        </div>
      `;
      document.body.appendChild(modal);
      modal.addEventListener('click', function(e) {
        if (e.target === modal) modal.remove();
      });
    }

    function showPDFModal(pdfPath) {
      const modal = document.createElement('div');
      modal.style.cssText = `
        position: fixed; top: 0; left: 0; right: 0; bottom: 0;
        background: rgba(0, 0, 0, 0.5); display: flex; align-items: center;
        justify-content: center; z-index: 3000; padding: 20px;
      `;
      modal.innerHTML = `
        <div style="
          background: white;
          border-radius: 10px;
          padding: 20px;
          max-width: 65%;
          width: 100%;
          max-height: 90vh;
          height: 100vh;
          display: flex;
          flex-direction: column;
          gap: 12px;
        ">
          <div style="display: flex; justify-content: space-between; align-items: center;">
            <h3 style="margin: 0; color: var(--primary);">PDF Preview</h3>
            <button id="closePdfBtn" style="
              background: none; border: none; font-size: 24px; cursor: pointer; color: var(--muted);
            ">‚úï</button>
          </div>

          <iframe 
            src="../uploads/${pdfPath}#toolbar=0&navpanes=0&scrollbar=0"
            style="
              width: 100%;
              height: 100%;
              border: none;
              border-radius: 8px;
            ">
          </iframe>

          <div style="margin-top: 0; text-align: center;">
            <button class="btn-small btn-small-primary" id="openPdfBtn">Open in new tab</button>
          </div>
        </div>
      `;
      document.body.appendChild(modal);

      // close handlers
      modal.addEventListener('click', function(e) {
        if (e.target === modal) modal.remove();
      });
      document.getElementById('closePdfBtn').addEventListener('click', () => modal.remove());

      // Open PDF in new tab instead of forcing replacement / direct download
      document.getElementById('openPdfBtn').addEventListener('click', function() {
        // open in new tab (use rel noopener for security)
        window.open(`../uploads/${pdfPath}`, '_blank', 'noopener');
        modal.remove();
      });
    }

    function showVideoModal(videoPath) {
      const modal = document.createElement('div');
      modal.style.cssText = `
        position: fixed; top: 0; left: 0; right: 0; bottom: 0;
        background: rgba(0, 0, 0, 0.5); display: flex; align-items: center;
        justify-content: center; z-index: 3000; padding: 20px;
      `;
      modal.innerHTML = `
        <div style="
          background: white;
          border-radius: 10px;
          padding: 20px;
          max-width: 65%;
          width: 60%;
          max-height: 90vh;
          height: 100vh;
          display: flex;
          flex-direction: column;
          gap: 12px;
        ">
          <div style="display: flex; justify-content: space-between; align-items: center;">
            <h3 style="margin: 0; color: var(--primary);">Video Preview</h3>
            <button onclick="this.closest('div').parentElement.remove()" style="
              background: none; border: none; font-size: 24px; cursor: pointer; color: var(--muted);">
              ‚úï
            </button>
          </div>
          <video controls style="width: 100%; height: 90%; border-radius: 8px; background: black;">
            <source src="../uploads/${videoPath}">
            Your browser does not support the video tag.
          </video>
          <div style="margin-top: 0; text-align: center;">
            <button class="btn-small btn-small-primary" onclick="
              const link = document.createElement('a');
              link.href = '../uploads/${videoPath}';
              link.download = '${videoPath}'.split('/').pop() || 'video';
              link.click();
            ">Download Video</button>
          </div>
        </div>
      `;
      document.body.appendChild(modal);
      modal.addEventListener('click', function(e) {
        if (e.target === modal) modal.remove();
      });
    }

    function showAudioModal(audioPath) {
      const modal = document.createElement('div');
      modal.style.cssText = `
        position: fixed; top: 0; left: 0; right: 0; bottom: 0;
        background: rgba(0, 0, 0, 0.5); display: flex; align-items: center;
        justify-content: center; z-index: 3000; padding: 20px;
      `;
      modal.innerHTML = `
        <div style="background: white; border-radius: 10px; padding: 30px; max-width: 500px; width: 100%;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h3 style="margin: 0; color: var(--primary);">Audio Player</h3>
            <button onclick="this.closest('div').parentElement.remove()" style="
              background: none; border: none; font-size: 24px; cursor: pointer; color: var(--muted);">
              ‚úï
            </button>
          </div>
          <audio controls style="width: 100%; margin-bottom: 20px;">
            <source src="../uploads/${audioPath}">
            Your browser does not support the audio tag.
          </audio>
          <div style="text-align: center;">
            <button class="btn-small btn-small-primary" onclick="
              const link = document.createElement('a');
              link.href = '../uploads/${audioPath}';
              link.download = '${audioPath}'.split('/').pop() || 'audio';
              link.click();
              this.closest('div').parentElement.remove();
            ">Download Audio</button>
          </div>
        </div>
      `;
      document.body.appendChild(modal);
      modal.addEventListener('click', function(e) {
        if (e.target === modal) modal.remove();
      });
    }

    function openReviewModal(projectId) {
      currentReviewProjectId = projectId;
      const projects = JSON.parse(localStorage.getItem('industryProjects') || '[]');
      const project = projects.find(p => p.id === projectId);

      if (!project) return;

      // Display submission files
      const submissionFilesDiv = document.getElementById('submissionFiles');
      if (project.submissions && project.submissions.length > 0) {
        submissionFilesDiv.innerHTML = project.submissions.map((sub, index) => {
          return createSubmissionItem(sub, index);
        }).join('');
      } else {
        submissionFilesDiv.innerHTML = '<p style="color: var(--muted); font-size: 13px;">No submissions yet</p>';
      }

      // Reset form
      document.getElementById('reviewRating').value = '0';
      document.getElementById('reviewComments').value = '';
      document.getElementById('paymentAmount').value = '';
      document.getElementById('paymentDisplay').textContent = 'Rp 0';
      document.getElementById('proofFilename').style.display = 'none';
      
      // Reset stars
      document.querySelectorAll('#starRating .star').forEach(star => star.classList.remove('active'));

      document.getElementById('reviewModal').classList.add('show');
    }

    function closeReviewModal() {
      document.getElementById('reviewModal').classList.remove('show');
      currentReviewProjectId = null;
    }

    // Star rating functionality
    // (Event listeners are now in the main DOMContentLoaded function)

    function approveWork() {
      if (!currentReviewProjectId) return;

      const rating = document.getElementById('reviewRating').value;
      const comments = document.getElementById('reviewComments').value.trim();
      const paymentAmount = document.getElementById('paymentAmount').value.trim();
      const proofFile = document.getElementById('paymentProofFile');

      if (!rating || rating === '0') {
        showNotification('Validation Error', 'Please provide a star rating', '‚ö†Ô∏è');
        return;
      }

      if (!comments) {
        showNotification('Validation Error', 'Please provide review comments', '‚ö†Ô∏è');
        return;
      }

      if (!paymentAmount) {
        showNotification('Validation Error', 'Please enter payment amount', '‚ö†Ô∏è');
        return;
      }

      if (!proofFile.files.length) {
        showNotification('Validation Error', 'Please upload payment proof', '‚ö†Ô∏è');
        return;
      }

      // Update project status to Completed
      let projects = JSON.parse(localStorage.getItem('industryProjects') || '[]');
      const projectIndex = projects.findIndex(p => p.id === currentReviewProjectId);

      if (projectIndex !== -1) {
        projects[projectIndex].status = 'Completed';
        projects[projectIndex].review = {
          rating: rating,
          comments: comments,
          paymentAmount: parseInt(paymentAmount),
          approvedDate: new Date().toISOString(),
          proofFile: proofFile.files[0].name
        };
        localStorage.setItem('industryProjects', JSON.stringify(projects));
      }

      closeReviewModal();
      loadProjects();
      loadDashboardData();
      showNotification('Success', 'Work has been approved and the project is completed!', '‚úì');
    }

    function rejectWork() {
      if (!currentReviewProjectId) return;

      const comments = document.getElementById('reviewComments').value.trim();

      // Update project status back to In Progress
      let projects = JSON.parse(localStorage.getItem('industryProjects') || '[]');
      const projectIndex = projects.findIndex(p => p.id === currentReviewProjectId);

      if (projectIndex !== -1) {
        projects[projectIndex].status = 'In Progress';
        projects[projectIndex].rejectionFeedback = {
          comments: comments,
          rejectedDate: new Date().toISOString()
        };
        localStorage.setItem('industryProjects', JSON.stringify(projects));
      }

      closeReviewModal();
      loadProjects();
      loadDashboardData();
    }
  </script>
</body>
</html>

